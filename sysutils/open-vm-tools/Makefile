# $NetBSD: Makefile,v 1.51 2015/04/25 14:24:54 tnn Exp $

DISTNAME=	open-vm-tools-9.10.2-2822639
PKGNAME=	${DISTNAME:C/-[0-9]+$//}
CATEGORIES=	sysutils
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=open-vm-tools/}

MAINTAINER=	agc@NetBSD.org
HOMEPAGE=	http://open-vm-tools.sourceforge.net/
COMMENT=	Open source VMware tools
LICENSE=	gnu-lgpl-v2.1

ONLY_FOR_PLATFORM=	*-*-i386 *-*-x86_64

GNU_CONFIGURE=	yes
USE_LANGUAGES+=	c c++
USE_LIBTOOL=	yes
USE_TOOLS+=	pkg-config

CONFIGURE_ARGS+=		--disable-deploypkg
CONFIGURE_ARGS+=		--disable-grabbitmqproxy
CONFIGURE_ARGS+=		--disable-vgauth
CONFIGURE_ARGS+=		--sysconfdir=${PKG_SYSCONFBASEDIR}

#INSTALLATION_DIRS+=		${PKG_SYSCONFDIR} share/examples/vmware-tools

PKG_SYSCONFSUBDIR=		vmware-tools
EGDIR=				${PREFIX}/share/examples/vmware-tools
OWN_DIRS+=	${PKG_SYSCONFDIR}/scripts/vmware
CONF_FILES_PERMS+=		${EGDIR}/poweroff-vm-default ${PKG_SYSCONFDIR}/poweroff-vm-default ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/poweron-vm-default ${PKG_SYSCONFDIR}/poweron-vm-default ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/resume-vm-default ${PKG_SYSCONFDIR}/resume-vm-default ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/suspend-vm-default ${PKG_SYSCONFDIR}/suspend-vm-default ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/statechange.subr ${PKG_SYSCONFDIR}/statechange.subr ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/vm-support ${PKG_SYSCONFDIR}/vm-support ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
CONF_FILES_PERMS+=		${EGDIR}/scripts/vmware/network ${PKG_SYSCONFDIR}/scripts/vmware/network ${REAL_ROOT_USER} ${REAL_ROOT_GROUP} 755
RCD_SCRIPTS=			vmtools

PKGCONFIG_OVERRIDE+=	libDeployPkg/libDeployPkg.pc.in
PKGCONFIG_OVERRIDE+=	libguestlib/vmguestlib.pc.in

INSTALL_MAKE_FLAGS+=	sysconfdir=${EGDIR}
INSTALL_MAKE_FLAGS+=	confdir=${EGDIR}

SUBST_CLASSES+=		confdir
SUBST_STAGE.confdir=	pre-configure
SUBST_SED.confdir=	-e s,/etc/vmware-tools,${PKG_SYSCONFDIR},g
SUBST_FILES.confdir+=	lib/guestApp/guestApp.c
SUBST_FILES.confdir+=	scripts/Makefile.in
SUBST_FILES.confdir+=	services/vmtoolsd/Makefile.in
SUBST_FILES.confdir+=	vgauth/common/prefs.h
SUBST_FILES.confdir+=	vgauth/service/Makefile.in
SUBST_FILES.confdir+=	vmware-user-suid-wrapper/wrapper.h

.include "../../net/libdnet/buildlink3.mk"
.include "../../security/openssl/buildlink3.mk"
.include "../../textproc/icu/buildlink3.mk"

.include "options.mk"

.include "../../devel/gettext-lib/buildlink3.mk"
.include "../../mk/fuse.buildlink3.mk"
PTHREAD_AUTO_VARS=	yes
.include "../../mk/pthread.buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
